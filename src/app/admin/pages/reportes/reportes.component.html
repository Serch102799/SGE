
<div class="usuarios-container">
  <div class="container-header">
    <h2>M√≥dulo de Reportes</h2>
  </div>

  <div class="container-body">
    <!-- Secci√≥n de Selecci√≥n -->
    <div class="report-section">
      <h3>Selecciona un Reporte</h3>
      <p>{{ descripcionReporte }}</p>

      <div class="filtros-container">
        <!-- Tipo de Reporte -->
        <div class="filtro-item">
          <label for="tipoReporte">Tipo de Reporte</label>
          <select 
            id="tipoReporte" 
            class="form-control" 
            [(ngModel)]="tipoReporteSeleccionado">
            <option value="stock-bajo">Stock Bajo</option>
            <option value="gastos-totales">Gastos Totales</option>
            <option value="menos-utilizadas">Refacciones Menos Utilizadas</option>
            <option value="mas-utilizadas">Refacciones M√°s Utilizadas</option>
            <option value="costo-autobus">Costo por Autob√∫s</option>
            <option value="movimientos-refaccion">Movimientos por Refacci√≥n</option>
          </select>
        </div>

        <!-- Fecha Inicio (solo si requiere fechas) -->
        <div class="filtro-item" *ngIf="requiereFechas">
          <label for="fechaInicio">Desde:</label>
          <input 
            type="date" 
            id="fechaInicio" 
            class="form-control" 
            [(ngModel)]="fechaInicio">
        </div>

        <!-- Fecha Fin (solo si requiere fechas) -->
        <div class="filtro-item" *ngIf="requiereFechas">
          <label for="fechaFin">Hasta:</label>
          <input 
            type="date" 
            id="fechaFin" 
            class="form-control" 
            [(ngModel)]="fechaFin">
        </div>
      </div>

      <button class="btn-agregar" (click)="generarReporte()" [disabled]="isLoading">
        <span *ngIf="!isLoading">üìä Generar Reporte</span>
        <span *ngIf="isLoading">‚è≥ Cargando...</span>
      </button>
      
      <p *ngIf="requiereFechas" style="margin-top: 15px; font-size: 0.85rem; color: #999;">
        Nota: El filtro de fecha aplica para este reporte.
      </p>
    </div>

    <!-- Resultados -->
    <div class="results-container" *ngIf="reporteData.length > 0">
      <div class="results-header">
        <h4>{{ tituloReporte }}</h4>
        <div class="export-buttons">
          <button class="btn-exportar" (click)="exportarPDF()">
            üìÑ Exportar a PDF
          </button>
          <button class="btn-excel" (click)="exportarExcel()">
            üìä Exportar a Excel
          </button>
        </div>
      </div>

      <!-- Total General (solo para gastos-totales) -->
      <div class="total-general" *ngIf="tipoReporteSeleccionado === 'gastos-totales' && totalGeneral > 0">
        Total General: ${{ totalGeneral | number:'1.2-2':'es-MX' }}
      </div>

      <!-- Tabla de Resultados -->
      <div class="tabla-responsive-wrapper">
        <table class="tabla-usuarios">
          <thead>
            <tr>
              <th *ngFor="let columna of columnasReporte">
                {{ formatearColumna(columna) }}
              </th>
            </tr>
          </thead>
          <tbody>
            <tr 
              *ngFor="let fila of reporteData"
              [class.alerta-stock-bajo]="fila.stock_actual < fila.stock_minimo">
              <td 
                *ngFor="let columna of columnasReporte"
                [class.stock-critico]="columna === 'stock_actual' && fila.stock_actual < fila.stock_minimo">
                {{ formatearValor(fila[columna], columna) }}
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Mensaje cuando no hay datos -->
    <div class="empty-table-message" *ngIf="reporteData.length === 0 && !isLoading">
      No hay datos para mostrar. Genera un reporte para ver los resultados.
    </div>

    <!-- Mensaje de carga -->
    <div class="loading-message" *ngIf="isLoading">
      Generando reporte...
    </div>
  </div>
</div>


<!-- Modal de Notificaci√≥n -->
<div class="modal-overlay" *ngIf="mostrarModalNotificacion" (click)="cerrarModalNotificacion()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header" [ngClass]="{
      'header-exito': notificacion.tipo === 'exito',
      'header-error': notificacion.tipo === 'error',
      'header-advertencia': notificacion.tipo === 'advertencia'
    }">
      <h3>{{ notificacion.titulo }}</h3>
      <button class="btn-cerrar" (click)="cerrarModalNotificacion()">&times;</button>
    </div>
    <div class="confirm-text">
      {{ notificacion.mensaje }}
    </div>
    <div class="modal-footer">
      <button class="btn-cancelar" (click)="cerrarModalNotificacion()">Cerrar</button>
    </div>
  </div>
</div>